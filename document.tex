%%%% Generic manuscript mode, required for submission
%%%% and peer review
\documentclass[manuscript,screen,review,sigplan]{acmart}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
\setcopyright{XXX}
\copyrightyear{XXXX}
\acmYear{XXXX}
\acmDOI{XXXXXXX.XXXXXXX}

%% These commands are for a PROCEEDINGS abstract or paper.
\acmConference[ICFP '22]{International Conference on Functional Programming}{Sept 11--16,
  2022}{Ljubljana, Slovenia}
%
%  Uncomment \acmBooktitle if th title of the proceedings is different
%  from ``Proceedings of ...''!
%
%\acmBooktitle{Woodstock '18: ACM Symposium on Neural Gaze Detection,
% June 03--05, 2018, Woodstock, NY}
%\acmPrice{15.00}
%\acmISBN{978-1-4503-XXXX-X/18/06}


%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% For managing citations, it is recommended to use bibliography
%% files in BibTeX format.
%%
%% You can then either use BibTeX with the ACM-Reference-Format style,
%% or BibLaTeX with the acmnumeric or acmauthoryear sytles, that include
%% support for advanced citation of software artefact from the
%% biblatex-software package, also separately available on CTAN.
%%
%% Look at the sample-*-biblatex.tex files for templates showcasing
%% the biblatex styles.
%%

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
%% Uncommenting
%% the next command will enable that style.
%%\citestyle{acmauthoryear}

\usepackage{listings}
\usepackage{amsthm}

\lstset{
  basicstyle=\ttfamily,
  mathescape
}

\newtheorem{theorem}{Theorem}

%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title{Equationally Correct Operational Semantics (Extended Abstract)}

%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.
\author{Cameron Wong}
\affiliation{%
  \institution{Harvard University}
  \country{USA}
}

%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.
\renewcommand{\shortauthors}{Wong}

%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.
%%
\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10003752.10003790.10002990</concept_id>
<concept_desc>Theory of computation~Logic and verification</concept_desc>
<concept_significance>500</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Theory of computation~Logic and verification}
%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.
\keywords{dependent types, soundness, language semantics}

%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

\section{Introduction}

\section{Type Safety as an Equation}

To reason equationally in the style of Bahr and Hutton, we must first find a
suitable equation to reason about.

Proving type safety most commonly requires proving the twin theorems of
progress and preservation \cite{harper:pfpl}. Colloquially, progress states
that ``well-typed programs do not get stuck'', and preservation states that
``a program has the same type after each evaluation step''. The latter seems
promising for an equational approach, as it is a statement \emph{equating} two
things -- namely, the type of an expression before and after being stepped.

We specify the target language by converting its typing judgment $\Gamma
\vdash e : \tau$ into an Agda function

\begin{equation}
  \texttt{typeof} : \texttt{Exp} \rightarrow \texttt{Maybe Type}
\end{equation}

with the property $\texttt{typeof}\ e = \tau$ iff $\emptyset \vdash e : \tau$.

We next amend the type of \texttt{step} to take a witness that its argument
is well-typed, which will be useful later:

\begin{equation}
  \texttt{step} : (e: \texttt{Exp}) \rightarrow (\emptyset \vdash e : \tau)
    \rightarrow \texttt{Exp}
\end{equation}

Finally, we must address values, which cannot be stepped. Typically, this is
expressed by having the \texttt{step} function return a partial value akin to
\texttt{Maybe}. However, this representation is extremely unwieldy to work with
in an equation, so we instead parameterize the \texttt{Exp} datatype by whether
it can be stepped.

\begin{lstlisting}
  data Steppable : Set where
    IsValue: Steppable
    CanStep: Steppable

  data Exp : Steppable $\rightarrow$ Set where
    ...

  step : ($e:$ Exp) $\rightarrow$ $(\emptyset \vdash e : \tau) \rightarrow \exists S . \texttt{Exp}\ S$
\end{lstlisting}

Note that \texttt{step} now hides the \texttt{Steppable} parameter of its
return type behind an existential, as we cannot know whether the result can be
evaluated further.

Agda enforces that functions are total, so any well-typed implementation of the
\texttt{step} function is a proof of the progress theorem. All the pieces are
in place, then, to relate progress (\texttt{step}) to the typing judgment
(\texttt{typeof}) via the \emph{preservation equation}:

\begin{equation}
  \texttt{typeof}\ e = \texttt{typeof}\ (\texttt{step e p})
\end{equation}

where $e : \texttt{Exp CanStep}$ and $p : (\emptyset \vdash e : \tau)$ for some
$\tau : \texttt{Type}$.

\section{The Derivation}

\subsection{Target Language}

\bibliographystyle{acm}
\bibliography{refs}

\end{document}
\endinput
%%
